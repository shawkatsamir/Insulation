async function loadBlogPosts(t){const e=document.getElementById("posts-container");if(e.innerHTML='<p class="loading-message">Loading posts...</p>',"file:"!==window.location.protocol)try{const o=await fetch("/data/blogPost.json");if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=(await o.json())[t];if(e.innerHTML="",!a||0===a.length)return void(e.innerHTML='<p class="error-message">No blog posts found.</p>');const n=document.createDocumentFragment();a.forEach(e=>{const o=document.createElement("article");o.classList.add("post-card"),o.innerHTML=`\n                <h2><a href="post.html?id=${e.id}&lang=${t}">${e.title}</a></h2>\n                <p class="post-meta">By ${e.author} on ${e.date}</p>\n                <p>${e.summary}</p>\n                <a href="post.html?id=${e.id}&lang=${t}" class="read-more">Read More</a>\n            `,n.appendChild(o)}),e.appendChild(n)}catch(t){console.error("Error loading blog posts:",t),e.innerHTML='<p class="error-message">Could not load blog posts. Please try again later.</p>'}else e.innerHTML='<p class="error-message">Cannot load posts directly from file system. Please run a local web server (e.g., with Live Server VS Code extension, or `python -m http.server`).</p>'}async function loadPostContent(t){const e=document.querySelector(".post-full");if(!e)return void console.error("Required element '.post-full' not found.");e.style.display="none";const o=document.createElement("p");if(o.className="loading-message",o.textContent="Loading post...",e.parentElement.insertBefore(o,e),"file:"!==window.location.protocol)try{const a=new URLSearchParams(window.location.search),n=parseInt(a.get("id")),r=a.get("lang")||t;if(isNaN(n))return void(o.textContent="Invalid Post ID.");const[c,l]=await Promise.all([fetch("/data/blogPost.json"),fetch(`/data/posts/${n}.json`)]);if(!c.ok||!l.ok)throw new Error(`HTTP error! Index: ${c.status}, Post: ${l.status}`);const s=await c.json(),i=await l.json(),d=s[r]?.find(t=>t.id===n),u=i[r];if(!d||!u)throw new Error("Post data or metadata not found for the current language.");document.title=u.title,document.querySelector('meta[name="description"]').setAttribute("content",d.summary);const h=document.querySelector('link[rel="canonical"]');h&&h.setAttribute("href",window.location.href);const m=document.querySelector(".post-title");m&&(m.textContent=u.title);const f=document.querySelector(".post-author");f&&(f.textContent=`By ${u.author}`);const y=document.querySelector(".post-date");y&&(y.textContent=u.date,y.setAttribute("datetime",u.date));const p=document.querySelector(".post-featured-image img");p&&(p.src=u.imageUrl,p.alt=u.imageAlt);const g=document.querySelector(".post-body");g&&(g.innerHTML=u.contentHtml);const S={"@context":"https://schema.org","@type":"BlogPosting",mainEntityOfPage:{"@type":"WebPage","@id":window.location.href},headline:u.title,description:d.summary,image:u.imageUrl,author:{"@type":"Organization",name:u.author},publisher:{"@type":"Organization",name:"عوازل مكة",logo:{"@type":"ImageObject",url:"https://www.insulmakkah.com/imgs/logo.png"}},datePublished:u.date,dateModified:u.date},k=document.getElementById("structured-data");k&&(k.textContent=JSON.stringify(S,null,2)),o.remove(),e.style.display="",u.relatedPosts&&u.relatedPosts.length>0&&loadRelatedPosts(u.relatedPosts,r),setupSocialSharing(u.title)}catch(t){console.error("Error loading post content:",t);(document.querySelector(".loading-message")||document.querySelector(".post-full").parentElement).innerHTML='<p class="error-message">Could not load post content. Please try again later.</p>'}else o.textContent="Cannot load post directly from file system. Please run a local web server."}async function loadRelatedPosts(t,e){const o=document.querySelector(".related-posts-container");if(o)try{const a=await fetch("/data/blogPost.json");if(!a.ok)throw new Error("Failed to fetch blog index");const n=await a.json(),r=n[e].filter(e=>t.includes(e.id));if(r.length>0){const t=document.createDocumentFragment();r.forEach(o=>{const a=document.createElement("div");a.className="related-post-card",a.innerHTML=`\n          <a href="post.html?id=${o.id}&lang=${e}">\n            <h4>${o.title}</h4>\n            <p>${o.summary}</p>\n          </a>\n        `,t.appendChild(a)}),o.appendChild(t)}}catch(t){console.error("Error loading related posts:",t),o.innerHTML="<p>Could not load related articles.</p>"}}function setupSocialSharing(t){const e=encodeURIComponent(window.location.href),o=encodeURIComponent(t),a=document.querySelector('.social-share-link[aria-label="Share on Facebook"]'),n=document.querySelector('.social-share-link[aria-label="Share on Twitter"]'),r=document.querySelector('.social-share-link[aria-label="Share on WhatsApp"]');a&&(a.href=`https://www.facebook.com/sharer/sharer.php?u=${e}`,a.target="_blank"),n&&(n.href=`https://twitter.com/intent/tweet?url=${e}&text=${o}`,n.target="_blank"),r&&(r.href=`https://api.whatsapp.com/send?text=${o}%20${e}`,r.target="_blank")}!function(){"use strict";const t={html:document.documentElement,callButton:document.querySelector(".btn-call"),callButtonIcon:document.querySelector(".btn-call .btn-call__icon"),langSwitcher:document.getElementById("lang-switcher"),header:{logo:document.querySelector("[data-key='header.logo']"),links:document.querySelectorAll("[data-key='header.links']")},hero:{title:document.querySelector("[data-key='hero.title']"),subtitle:document.querySelector("[data-key='hero.subtitle']")},trustItems:document.querySelectorAll(".hero-trust__item span"),contactButtons:{call:document.querySelectorAll("[data-key='contact.buttons.callBtn']"),whatsapp:document.querySelectorAll("[data-key='contact.buttons.whatsappBtn']")},locations:{heroLocations:document.querySelectorAll("[data-key='locations.hero.list']"),contactLocations:document.querySelectorAll("[data-key='locations.contact.list']"),heading:document.querySelectorAll("[data-key='locations.heading']"),footer:document.querySelectorAll("[data-key='locations.footerText']")},services:{header:{name:document.querySelector("[data-key='services.header.name']"),title:document.querySelector("[data-key='services.header.title']"),subtitle:document.querySelector("[data-key='services.header.subtitle']")},cards:document.querySelectorAll(".service-card")},whyUs:{header:{name:document.querySelector("[data-key='whyUs.header.name']"),title:document.querySelector("[data-key='whyUs.header.title']"),subtitle:document.querySelector("[data-key='whyUs.header.subtitle']")},items:document.querySelectorAll(".why-us__item")},contactUs:{header:{name:document.querySelector("[data-key='contact.header.name']"),subtitle:document.querySelector("[data-key='contact.header.subtitle']")},labels:{phone:document.querySelector("[data-key='contact_us.contactInfo.phoneLabel']"),whatsapp:document.querySelector("[data-key='contact_us.contactInfo.whatsappLabel']"),email:document.querySelector("[data-key='contact_us.contactInfo.emailLabel']")},locations:{locationsArea:document.querySelectorAll(".locations-list li"),heading:document.querySelectorAll("[data-key='locations.heading']"),footer:document.querySelectorAll("[data-key='locations.footerText']")},trustItems:document.querySelectorAll(".hero-trust--contact span")},footer:{footerAboutName:document.querySelector(".footer__name"),footerAboutDesc:document.querySelector(".footer__desc"),quickLinksTitle:document.querySelector(".footer__section:nth-child(2) .footer__title"),quickLinksHome:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(1) a"),quickLinksServices:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(2) a"),quickLinksWhyUs:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(3) a"),quickLinksContact:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(4) a"),ourServicesTitle:document.querySelector(".footer__section:nth-child(3) .footer__title"),ourServicesRoof:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(1) a"),ourServicesLeak:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(2) a"),ourServicesTank:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(3) a"),ourServicesBathroom:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(4) a"),contactUsTitle:document.querySelector(".footer__section:nth-child(4) .footer__title"),contactUsPhone:document.querySelector(".footer__contact li:nth-child(1) a"),contactUsWhatsapp:document.querySelector(".footer__contact li:nth-child(2) a"),contactUsEmail:document.querySelector(".footer__contact li:nth-child(3) a"),bottomBarCopyright:document.querySelector(".footer-bottom p"),bottomBarLangToggle:document.querySelector(".footer-bottom__lang-toggle button")},schema:document.getElementById("schema-data")};let e={};const o=(t,e)=>{t&&void 0!==e&&(t.textContent=e)};function a(a){t.html.setAttribute("lang",a),t.html.setAttribute("dir","ar"===a?"rtl":"ltr"),localStorage.setItem("preferred-lang",a),function(a){if(!e[a])return;const n=e[a];if(o(t.header.logo,n.header.logo),o(t.hero.title,n.hero.title),o(t.hero.subtitle,n.hero.subtitle),o(t.services.header.name,n.services.header.name),o(t.services.header.title,n.services.header.title),o(t.services.header.subtitle,n.services.header.subtitle),o(t.whyUs.header.name,n.whyUs.header.name),o(t.whyUs.header.title,n.whyUs.header.title),o(t.whyUs.header.subtitle,n.whyUs.header.subtitle),o(t.contactUs.header.name,n.contact_us.header.name),o(t.contactUs.header.subtitle,n.contact_us.header.subtitle),o(t.contactUs.labels.phone,n.contact_us.contactInfo.phoneLabel),o(t.contactUs.labels.whatsapp,n.contact_us.contactInfo.whatsappLabel),o(t.contactUs.labels.email,n.contact_us.contactInfo.emailLabel),t.contactButtons.call.forEach(t=>o(t,n.contact.callBtn)),t.contactButtons.whatsapp.forEach(t=>o(t,n.contact.whatsappBtn)),t.header.links.forEach((t,e)=>o(t,n.header.links[e])),t.trustItems.forEach((t,e)=>o(t,n.hero.trustItems[e]?.text)),t.contactUs.trustItems.forEach((t,e)=>o(t,n.contact_us.trustItems[e]?.text)),o(t.contactUs.labels.phone,n.contact_us.contactInfo.phoneLabel),t.locations.heading.forEach(t=>o(t,n.locations.heading)),t.locations.footer.forEach(t=>o(t,n.locations.footerText)),t.locations.heroLocations.forEach((t,e)=>o(t,n.locations.hero.list[e])),t.locations.contactLocations.forEach((t,e)=>o(t,n.locations.contact.list[e])),t.services.cards.forEach((t,e)=>{const a=n.services.cards[e];a&&(o(t.querySelector(".service-card__title"),a.title),o(t.querySelector(".services-card__subtitle"),a.subtitle),t.querySelectorAll(".service-card__features-item span").forEach((t,e)=>{o(t,a.features[e])}))}),t.whyUs.items.forEach((t,e)=>{const a=n.whyUs.items[e];a&&(o(t.querySelector(".why-us__item-title"),a.title),o(t.querySelector(".why-us__item-text"),a.text))}),o(t.footer.footerAboutName,n.footer.about.name),o(t.footer.footerAboutDesc,n.footer.about.description),o(t.footer.quickLinksTitle,n.footer.quickLinks.title),o(t.footer.quickLinksHome,n.footer.quickLinks.home),o(t.footer.quickLinksServices,n.footer.quickLinks.services),o(t.footer.quickLinksWhyUs,n.footer.quickLinks.whyUs),o(t.footer.quickLinksContact,n.footer.quickLinks.contact),o(t.footer.ourServicesTitle,n.footer.ourServices.title),o(t.footer.ourServicesRoof,n.footer.ourServices.roofInsulation),o(t.footer.ourServicesLeak,n.footer.ourServices.leakDetection),o(t.footer.ourServicesTank,n.footer.ourServices.tankInsulation),o(t.footer.ourServicesBathroom,n.footer.ourServices.bathroomWaterproofing),o(t.footer.contactUsTitle,n.footer.contactUs.title),o(t.footer.contactUsPhone,n.footer.contactUs.phone),o(t.footer.contactUsWhatsapp,n.footer.contactUs.whatsapp),o(t.footer.contactUsEmail,n.footer.contactUs.email),o(t.footer.bottomBarCopyright,n.footer.bottomBar.copyright),o(t.footer.bottomBarLangToggle,n.footer.bottomBar.languageToggle),t.schema)try{const e=JSON.parse(t.schema.textContent);e.name=n.hero.title,e.description=n.hero.subtitle,t.schema.textContent=JSON.stringify(e,null,2)}catch(t){console.error("Failed to parse or update schema data.",t)}}(a)}function n(){a("ar"===(t.html.getAttribute("lang")||"ar")?"en":"ar")}async function r(){await async function(){const t=localStorage.getItem("translations");if(t)e=JSON.parse(t);else try{const t=await fetch("./data/translation.json");e=await t.json(),localStorage.setItem("translations",JSON.stringify(e))}catch(t){console.error("Failed to load translations:",t)}}();const o=localStorage.getItem("preferred-lang"),r=(navigator.language||navigator.userLanguage).startsWith("ar");a(o||(r?"ar":"en")),t.callButton&&t.callButton.addEventListener("click",()=>{t.callButtonIcon&&(t.callButtonIcon.style.animation="vibrate 0.3s",setTimeout(()=>{t.callButtonIcon.style.animation=""},300))}),t.langSwitcher&&t.langSwitcher.addEventListener("click",n)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r()}(),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("posts-container"),e=document.querySelector(".post-full");let o=document.documentElement.lang||"en";t&&loadBlogPosts(o),e&&loadPostContent(o)});