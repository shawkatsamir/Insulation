(function(){"use strict";const elements={html:document.documentElement,callButton:document.querySelector(".btn-call"),callButtonIcon:document.querySelector(".btn-call .btn-call__icon"),langSwitcher:document.getElementById("lang-switcher"),header:{logo:document.querySelector("[data-key='header.logo']"),links:document.querySelectorAll("[data-key='header.links']")},hero:{title:document.querySelector("[data-key='hero.title']"),subtitle:document.querySelector("[data-key='hero.subtitle']")},trustItems:document.querySelectorAll(".hero-trust__item span"),contactButtons:{call:document.querySelectorAll("[data-key='contact.buttons.callBtn']"),whatsapp:document.querySelectorAll("[data-key='contact.buttons.whatsappBtn']")},locations:{heroLocations:document.querySelectorAll("[data-key='locations.hero.list']"),contactLocations:document.querySelectorAll("[data-key='locations.contact.list']"),heading:document.querySelectorAll("[data-key='locations.heading']"),footer:document.querySelectorAll("[data-key='locations.footerText']")},services:{header:{name:document.querySelector("[data-key='services.header.name']"),title:document.querySelector("[data-key='services.header.title']"),subtitle:document.querySelector("[data-key='services.header.subtitle']")},cards:document.querySelectorAll(".service-card")},whyUs:{header:{name:document.querySelector("[data-key='whyUs.header.name']"),title:document.querySelector("[data-key='whyUs.header.title']"),subtitle:document.querySelector("[data-key='whyUs.header.subtitle']")},items:document.querySelectorAll(".why-us__item")},contactUs:{header:{name:document.querySelector("[data-key='contact.header.name']"),subtitle:document.querySelector("[data-key='contact.header.subtitle']")},labels:{phone:document.querySelector("[data-key='contact_us.contactInfo.phoneLabel']"),whatsapp:document.querySelector("[data-key='contact_us.contactInfo.whatsappLabel']"),email:document.querySelector("[data-key='contact_us.contactInfo.emailLabel']")},locations:{locationsArea:document.querySelectorAll(".locations-list li"),heading:document.querySelectorAll("[data-key='locations.heading']"),footer:document.querySelectorAll("[data-key='locations.footerText']")},trustItems:document.querySelectorAll(".hero-trust--contact span")},footer:{footerAboutName:document.querySelector(".footer__name"),footerAboutDesc:document.querySelector(".footer__desc"),quickLinksTitle:document.querySelector(".footer__section:nth-child(2) .footer__title"),quickLinksHome:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(1) a"),quickLinksServices:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(2) a"),quickLinksWhyUs:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(3) a"),quickLinksContact:document.querySelector(".footer__section:nth-child(2) .footer__links li:nth-child(4) a"),ourServicesTitle:document.querySelector(".footer__section:nth-child(3) .footer__title"),ourServicesRoof:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(1) a"),ourServicesLeak:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(2) a"),ourServicesTank:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(3) a"),ourServicesBathroom:document.querySelector(".footer__section:nth-child(3) .footer__links li:nth-child(4) a"),contactUsTitle:document.querySelector(".footer__section:nth-child(4) .footer__title"),contactUsPhone:document.querySelector(".footer__contact li:nth-child(1) a"),contactUsWhatsapp:document.querySelector(".footer__contact li:nth-child(2) a"),contactUsEmail:document.querySelector(".footer__contact li:nth-child(3) a"),bottomBarCopyright:document.querySelector(".footer-bottom p"),bottomBarLangToggle:document.querySelector(".footer-bottom__lang-toggle button")},schema:document.getElementById("schema-data")};let translations={};async function loadTranslations(){try{const response=await fetch("./data/translation.json");translations=await response.json()}catch(error){console.error("Failed to load translations:",error)}}const setText=(el,text)=>{if(el&&text!==undefined)el.textContent=text};function updateContent(lang){if(!translations[lang])return;const t=translations[lang];setText(elements.header.logo,t.header.logo);setText(elements.hero.title,t.hero.title);setText(elements.hero.subtitle,t.hero.subtitle);setText(elements.services.header.name,t.services.header.name);setText(elements.services.header.title,t.services.header.title);setText(elements.services.header.subtitle,t.services.header.subtitle);setText(elements.whyUs.header.name,t.whyUs.header.name);setText(elements.whyUs.header.title,t.whyUs.header.title);setText(elements.whyUs.header.subtitle,t.whyUs.header.subtitle);setText(elements.contactUs.header.name,t.contact_us.header.name);setText(elements.contactUs.header.subtitle,t.contact_us.header.subtitle);setText(elements.contactUs.labels.phone,t.contact_us.contactInfo.phoneLabel);setText(elements.contactUs.labels.whatsapp,t.contact_us.contactInfo.whatsappLabel);setText(elements.contactUs.labels.email,t.contact_us.contactInfo.emailLabel);elements.contactButtons.call.forEach(el=>setText(el,t.contact.callBtn));elements.contactButtons.whatsapp.forEach(el=>setText(el,t.contact.whatsappBtn));elements.header.links.forEach((el,i)=>setText(el,t.header.links[i]));elements.trustItems.forEach((span,i)=>setText(span,t.hero.trustItems[i]?.text));elements.contactUs.trustItems.forEach((span,i)=>setText(span,t.contact_us.trustItems[i]?.text));setText(elements.contactUs.labels.phone,t.contact_us.contactInfo.phoneLabel);elements.locations.heading.forEach(el=>setText(el,t.locations.heading));elements.locations.footer.forEach(el=>setText(el,t.locations.footerText));elements.locations.heroLocations.forEach((el,i)=>setText(el,t.locations.hero.list[i]));elements.locations.contactLocations.forEach((el,i)=>setText(el,t.locations.contact.list[i]));elements.services.cards.forEach((card,i)=>{const cardData=t.services.cards[i];if(!cardData)return;setText(card.querySelector(".service-card__title"),cardData.title);setText(card.querySelector(".services-card__subtitle"),cardData.subtitle);card.querySelectorAll(".service-card__features-item span").forEach((feature,j)=>{setText(feature,cardData.features[j])})});elements.whyUs.items.forEach((item,i)=>{const itemData=t.whyUs.items[i];if(!itemData)return;setText(item.querySelector(".why-us__item-title"),itemData.title);setText(item.querySelector(".why-us__item-text"),itemData.text)});setText(elements.footer.footerAboutName,t.footer.about.name);setText(elements.footer.footerAboutDesc,t.footer.about.description);setText(elements.footer.quickLinksTitle,t.footer.quickLinks.title);setText(elements.footer.quickLinksHome,t.footer.quickLinks.home);setText(elements.footer.quickLinksServices,t.footer.quickLinks.services);setText(elements.footer.quickLinksWhyUs,t.footer.quickLinks.whyUs);setText(elements.footer.quickLinksContact,t.footer.quickLinks.contact);setText(elements.footer.ourServicesTitle,t.footer.ourServices.title);setText(elements.footer.ourServicesRoof,t.footer.ourServices.roofInsulation);setText(elements.footer.ourServicesLeak,t.footer.ourServices.leakDetection);setText(elements.footer.ourServicesTank,t.footer.ourServices.tankInsulation);setText(elements.footer.ourServicesBathroom,t.footer.ourServices.bathroomWaterproofing);setText(elements.footer.contactUsTitle,t.footer.contactUs.title);setText(elements.footer.contactUsPhone,t.footer.contactUs.phone);setText(elements.footer.contactUsWhatsapp,t.footer.contactUs.whatsapp);setText(elements.footer.contactUsEmail,t.footer.contactUs.email);setText(elements.footer.bottomBarCopyright,t.footer.bottomBar.copyright);setText(elements.footer.bottomBarLangToggle,t.footer.bottomBar.languageToggle);if(elements.schema){try{const schemaData=JSON.parse(elements.schema.textContent);schemaData.name=t.hero.title;schemaData.description=t.hero.subtitle;elements.schema.textContent=JSON.stringify(schemaData,null,2)}catch(e){console.error("Failed to parse or update schema data.",e)}}}function setLanguage(lang){elements.html.setAttribute("lang",lang);elements.html.setAttribute("dir",lang==="ar"?"rtl":"ltr");localStorage.setItem("preferred-lang",lang);updateContent(lang)}function switchLang(){const currentLang=elements.html.getAttribute("lang")||"ar";setLanguage(currentLang==="ar"?"en":"ar")}async function initialize(){await loadTranslations();const savedLang=localStorage.getItem("preferred-lang");const browserLangIsArabic=(navigator.language||navigator.userLanguage).startsWith("ar");const initialLang=savedLang||(browserLangIsArabic?"ar":"en");setLanguage(initialLang);if(elements.callButton){elements.callButton.addEventListener("click",()=>{if(elements.callButtonIcon){elements.callButtonIcon.style.animation="vibrate 0.3s";setTimeout(()=>{elements.callButtonIcon.style.animation=""},300)}})}if(elements.langSwitcher){elements.langSwitcher.addEventListener("click",switchLang)}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initialize)}else{initialize()}})();document.addEventListener("DOMContentLoaded",function(){const header=document.querySelector(".header");const btnToggle=document.querySelector(".button-mobile__toggle");const navLinksContainer=document.querySelector(".header-navbar__links");const stickyButtons=document.querySelector(".sticky-buttons");const allSections=document.querySelectorAll(".section");if(btnToggle&&header){btnToggle.addEventListener("click",function(){header.classList.toggle("nav-open");const isOpen=header.classList.contains("nav-open");btnToggle.setAttribute("aria-expanded",isOpen)})}if(navLinksContainer&&header){navLinksContainer.addEventListener("click",function(e){const target=e.target.closest("a");if(!target||window.innerWidth>768)return;if(header.classList.contains("nav-open")){header.classList.remove("nav-open");btnToggle?.setAttribute("aria-expanded","false")}})}if(navLinksContainer){navLinksContainer.addEventListener("click",function(e){const target=e.target.closest("a");if(!target||!target.hash||target.hash==="#")return;e.preventDefault();const hash=target.hash;const targetElement=document.querySelector(hash);if(targetElement){setTimeout(()=>{targetElement.scrollIntoView({behavior:"smooth",block:"start"});history.pushState(null,"",hash)},50)}})}const revealSection=function(entries,observer){const[entry]=entries;if(entry.isIntersecting){entry.target.classList.remove("section--hidden");observer.unobserve(entry.target)}};const sectionObserver=new IntersectionObserver(revealSection,{threshold:.15,rootMargin:"0px 0px -100px 0px"});allSections.forEach(section=>{section.classList.add("section--hidden");sectionObserver.observe(section)});const sectionsToHideButtons=[document.querySelector(".hero"),document.querySelector(".contact-us"),document.querySelector(".footer")];const handleStickyButtons=entries=>{let isInSection=false;entries.forEach(entry=>{if(entry.isIntersecting)isInSection=true});if(isInSection){stickyButtons?.classList.remove("show")}else{stickyButtons?.classList.add("show")}};const buttonObserver=new IntersectionObserver(handleStickyButtons,{threshold:.2});sectionsToHideButtons.forEach(section=>{if(section)buttonObserver.observe(section)});window.addEventListener("load",()=>{document.body.style.overflow="";if(header.classList.contains("nav-open")){header.classList.remove("nav-open")}});const btn=document.querySelector(".btn-back-to-top");if(!btn)return;window.addEventListener("scroll",function(){if(window.scrollY>300){btn.classList.add("show")}else{btn.classList.remove("show")}});btn.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})})});document.addEventListener("DOMContentLoaded",()=>{const postsContainer=document.getElementById("posts-container");const postContainer=document.querySelector(".post-full");let lang=document.documentElement.lang||"en";if(postsContainer){loadBlogPosts(lang)}if(postContainer){loadPostContent(lang)}});async function loadBlogPosts(lang){const postsContainer=document.getElementById("posts-container");postsContainer.innerHTML='<p class="loading-message">Loading posts...</p>';if(window.location.protocol==="file:"){postsContainer.innerHTML='<p class="error-message">Cannot load posts directly from file system. Please run a local web server (e.g., with Live Server VS Code extension, or `python -m http.server`).</p>';return}try{const response=await fetch("/data/blogPost.json");if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}const data=await response.json();const posts=data[lang];postsContainer.innerHTML="";if(!posts||posts.length===0){postsContainer.innerHTML='<p class="error-message">No blog posts found.</p>';return}const fragment=document.createDocumentFragment();posts.forEach(post=>{const postCard=document.createElement("article");postCard.classList.add("post-card");postCard.innerHTML=`\n                <h2><a href="post.html?id=${post.id}&lang=${lang}">${post.title}</a></h2>\n                <p class="post-meta">By ${post.author} on ${post.date}</p>\n                <p>${post.summary}</p>\n                <a href="post.html?id=${post.id}&lang=${lang}" class="read-more">Read More</a>\n            `;fragment.appendChild(postCard)});postsContainer.appendChild(fragment)}catch(error){console.error("Error loading blog posts:",error);postsContainer.innerHTML='<p class="error-message">Could not load blog posts. Please try again later.</p>'}}async function loadPostContent(lang){const postContainer=document.querySelector(".post-full");if(!postContainer){console.error("Required element '.post-full' not found.");return}postContainer.style.display="none";const loadingIndicator=document.createElement("p");loadingIndicator.className="loading-message";loadingIndicator.textContent="Loading post...";postContainer.parentElement.insertBefore(loadingIndicator,postContainer);if(window.location.protocol==="file:"){loadingIndicator.textContent="Cannot load post directly from file system. Please run a local web server.";return}try{const urlParams=new URLSearchParams(window.location.search);const postId=parseInt(urlParams.get("id"));const currentLang=urlParams.get("lang")||lang;if(isNaN(postId)){loadingIndicator.textContent="Invalid Post ID.";return}const[indexResponse,postResponse]=await Promise.all([fetch("/data/blogPost.json"),fetch(`/data/posts/${postId}.json`)]);if(!indexResponse.ok||!postResponse.ok){throw new Error(`HTTP error! Index: ${indexResponse.status}, Post: ${postResponse.status}`)}const indexData=await indexResponse.json();const postData=await postResponse.json();const postMetadata=indexData[currentLang]?.find(p=>p.id===postId);const postContent=postData[currentLang];if(!postMetadata||!postContent){throw new Error("Post data or metadata not found for the current language.")}document.title=postContent.title;document.querySelector('meta[name="description"]').setAttribute("content",postMetadata.summary);const canonicalLink=document.querySelector('link[rel="canonical"]');if(canonicalLink){canonicalLink.setAttribute("href",window.location.href)}const postTitleEl=document.querySelector(".post-title");if(postTitleEl)postTitleEl.textContent=postContent.title;const postAuthorEl=document.querySelector(".post-author");if(postAuthorEl)postAuthorEl.textContent=`By ${postContent.author}`;const postDateEl=document.querySelector(".post-date");if(postDateEl){postDateEl.textContent=postContent.date;postDateEl.setAttribute("datetime",postContent.date)}const featuredImageEl=document.querySelector(".post-featured-image img");if(featuredImageEl){featuredImageEl.src=postContent.imageUrl;featuredImageEl.alt=postContent.imageAlt}const postBodyEl=document.querySelector(".post-body");if(postBodyEl)postBodyEl.innerHTML=postContent.contentHtml;const structuredData={"@context":"https://schema.org","@type":"BlogPosting",mainEntityOfPage:{"@type":"WebPage","@id":window.location.href},headline:postContent.title,description:postMetadata.summary,image:postContent.imageUrl,author:{"@type":"Organization",name:postContent.author},publisher:{"@type":"Organization",name:"عوازل مكة",logo:{"@type":"ImageObject",url:"https://www.insulmakkah.com/imgs/logo.png"}},datePublished:postContent.date,dateModified:postContent.date};const structuredDataEl=document.getElementById("structured-data");if(structuredDataEl){structuredDataEl.textContent=JSON.stringify(structuredData,null,2)}loadingIndicator.remove();postContainer.style.display="";if(postContent.relatedPosts&&postContent.relatedPosts.length>0){loadRelatedPosts(postContent.relatedPosts,currentLang)}setupSocialSharing(postContent.title)}catch(error){console.error("Error loading post content:",error);const errorEl=document.querySelector(".loading-message")||document.querySelector(".post-full").parentElement;errorEl.innerHTML='<p class="error-message">Could not load post content. Please try again later.</p>'}}async function loadRelatedPosts(relatedIds,lang){const container=document.querySelector(".related-posts-container");if(!container)return;try{const response=await fetch("/data/blogPost.json");if(!response.ok)throw new Error("Failed to fetch blog index");const indexData=await response.json();const allPosts=indexData[lang];const relatedPosts=allPosts.filter(post=>relatedIds.includes(post.id));if(relatedPosts.length>0){const fragment=document.createDocumentFragment();relatedPosts.forEach(post=>{const card=document.createElement("div");card.className="related-post-card";card.innerHTML=`\n          <a href="post.html?id=${post.id}&lang=${lang}">\n            <h4>${post.title}</h4>\n            <p>${post.summary}</p>\n          </a>\n        `;fragment.appendChild(card)});container.appendChild(fragment)}}catch(error){console.error("Error loading related posts:",error);container.innerHTML="<p>Could not load related articles.</p>"}}function setupSocialSharing(title){const pageUrl=encodeURIComponent(window.location.href);const pageTitle=encodeURIComponent(title);const facebookLink=document.querySelector('.social-share-link[aria-label="Share on Facebook"]');const twitterLink=document.querySelector('.social-share-link[aria-label="Share on Twitter"]');const whatsappLink=document.querySelector('.social-share-link[aria-label="Share on WhatsApp"]');if(facebookLink){facebookLink.href=`https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;facebookLink.target="_blank"}if(twitterLink){twitterLink.href=`https://twitter.com/intent/tweet?url=${pageUrl}&text=${pageTitle}`;twitterLink.target="_blank"}if(whatsappLink){whatsappLink.href=`https://api.whatsapp.com/send?text=${pageTitle}%20${pageUrl}`;whatsappLink.target="_blank"}}